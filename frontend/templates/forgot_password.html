{% extends 'base.html' %}
{% block title %}Forgot Password{% endblock %}
{% block content %}
<div class="form-card narrow">
    <form method="post" class="card form-card">
        <h1>Reset Password</h1>
        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
            {% if role == 'user' %}
                Enter your Health ID and phone number to receive an OTP
            {% else %}
                Enter your email and phone number to receive an OTP
            {% endif %}
        </p>
        
        <input type="hidden" name="step" value="{{ step or 'request' }}">
        
        {% if step == 'verify' %}
            <!-- Verify OTP and Set New Password -->
            {% if role == 'user' %}
            <div class="form-group">
                <label>Health ID</label>
                <input type="text" value="{{ identifier }}" readonly style="background: var(--bg-light);">
            </div>
            <input type="hidden" name="identifier" value="{{ identifier }}">
            {% else %}
            <div class="form-group">
                <label>Email</label>
                <input type="email" value="{{ email }}" readonly style="background: var(--bg-light);">
            </div>
            <input type="hidden" name="email" value="{{ email }}">
            {% endif %}
            
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" value="{{ phone }}" readonly style="background: var(--bg-light);">
            </div>
            <input type="hidden" name="phone" value="{{ phone }}">
            
            <div class="form-group">
                <label for="otp_code">Enter OTP</label>
                <input type="text" id="otp_code" name="otp_code" required placeholder="Enter 6-digit OTP" maxlength="6" pattern="[0-9]{6}">
                <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">OTP sent to your phone. Valid for 10 minutes.</small>
            </div>
            
            <div class="form-group">
                <label for="new_password">New Password</label>
                <input type="password" id="new_password" name="new_password" required placeholder="Enter new password" minlength="6">
            </div>
            
            <div class="form-group">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" id="confirm_password" name="confirm_password" required placeholder="Confirm new password" minlength="6">
            </div>
            
            <button type="submit" class="btn primary full-width">Reset Password</button>
        {% else %}
            <!-- Request OTP -->
            {% if role == 'user' %}
            <div class="form-group">
                <label for="identifier">Health ID</label>
                <input type="text" id="identifier" name="identifier" required placeholder="e.g. H-1234-ABCD">
            </div>
            {% else %}
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required placeholder="{% if role == 'doctor' %}doctor@hospital.com{% else %}admin@hospital.com{% endif %}">
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" required placeholder="e.g. 916377429064">
            </div>
            
            <button type="submit" class="btn primary full-width">Send OTP</button>
        {% endif %}
        
        <p class="form-footnote" style="margin-top: 1rem;">
            <a href="{% if role == 'user' %}{{ url_for('user_login') }}{% elif role == 'doctor' %}{{ url_for('doctor_login') }}{% else %}{{ url_for('hospital_login') }}{% endif %}" style="color: var(--primary); font-weight: 600;">Back to Login</a>
        </p>
    </form>
</div>
{% endblock %}

